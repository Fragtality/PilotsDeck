# Pilot's Deck
Directly control Prepar3D&#x00AE; from your StreamDeck&#x00AE; via FSUIPC!
<br/><br/>
## Introduction
As the Title suggests, this is a Plugin for Elegato's StreamDeck for the FlightSimmers out there in need of just more Buttons! :wink:<br/>
It is build arround FSUIPC - so nearly everything which can be done with FSUIPC, can also be done via this Plugin. It is for the FlightSimmer already familiar with FSUIPC looking for an interesting Device to bind their Commands.<br/>
The Plugin is designed to be highly flexible and customizable, so it won't give any nice Guidance on what Offsets, Controls, Macros, ... are and it won't give you a nice List of Controls to select from. It even does not have anything pre-configured on the "COM Radio" Action - so you can make it work which fits best four your Aircraft(s).<br/><br/>
The Communication is Bi-Directional - it does not only send Commands into the Sim, it can also read & display a Controls State and can basically display any Value you want.<br/>
Another "Highlight" would be that you can "read" (generate) Values via Lua-Scripts.
<br/><br/>
## Plugin Requirements
Uhm ... I'd say Prepar3D, FSUIPC and StreamDeck (Software) installed would be a bloody good Start :laughing:<br/>
It is compiled for .NET Framework 4.8, so if you have a more or less regulary patched Windows&#x00AE; 10 (>= 1809) and have all of the above running you're probably ready for Takeoff!<br/>
It may work with FSX and older Versions of P3D/FSUIPC - the Plugin only reacts when "Prepar3D.exe" is loaded, so FSX would require a Change of the [Application Settings]<br/>
<br/><br/>
## Plugin Installation
It is not (yet) distributed in the StreamDeck Store, so it is a manual Installation for now.<br/>
Just put the Contents of the Zip in your Plugin-Folder under<br/>
  > **%appdata%\Elgato\StreamDeck\Plugins**

Optional: If you need/want to read Values generated by Lua-Scripts, you have to add the [PilotsDeck.lua](https://github.com/Fragtality/PilotsDeck/blob/master/PilotsDeck/lua/PilotsDeck.lua) Script in the \lua Subfolder to your FSUIPC Installation as an Autostart Script. More Instructions can be found in that File.
<br/><br/>
## Overview of included Actions
As of now, there are 7 Actions:<br/>
* **Display Value** - Read any Offset, Lvar (and Lua - more on that later) Value and display it as Text. You can Scale, Round, Format and/or BCD-Decode the Value and you can customize the resulting Text to your liking.
* **Display Value (with) Switch** - Same as before, but you can bind Macro(s), Control(s), Lvar(s) an Offset or a Lua-Script to it so that the Button does actually do something.
* **Simple Button** - As simple as it gets - a straight-forward Button like any of your Joystick-Buttons. BUT: it can be added to Multi-Actions in StreamDeck, so you can build Action-Sequences!
* **Dynamic Button** - My Reason to start this Journey - a Button which reflects the actual State of a Control in the Sim! It does not matter from which Input Device you alter a Control: this Button will show the correct State. (As long as this State can be correctly read from the Sim / Aircraft)
* **COM Radio** - It is more or less a "Display Value Switch" with two Values instead of one. Read the Radios from anywhere you want (BCD encoded or Integer) and swap the Frequencies by any Way you want.
* **Display Gauge** - If you want a graphical Representation of a Value, let's say for your Engines N1 Value, Trim, Control Surface Deflection, Fuel Level ... this Action is for you! It can either be a Bar or an Arc. With Text or without.
* **Display Gauge Dual** - New! Now with two Indicators instead of one! So you can have your Left/Right, Engine 1/Engine 2 or whatever in one Display.
<br/><br/>
## Action Configuration
Now we're getting to the "Fun" part! :flushed:<br/>
The Actions behave like any other Actions on the StreamDeck. All the Action's Settings are stored in the StreamDeck Profiles. They can be moved arround, swapped, copy-pasted and put in Folders. In case of the "Simple Button" it can be put in Multi-Actions like normal. Only replacing one Type with another could lead to unexpected Results and is "not recommended".<br/>
All Configuration is done via the Property Inspector. Some Input-Fields combine multiple Fiels/Inputs in one string, so let's start with the common Syntax:<br/>
### Common Syntax & Fields
Plain Numeric Values are separated by "**;**". E.g. an Size or Range Definition like "0; 10"<br/>
Addresses and Format are separated by "**:**".
#### Address Fields
* **Offset**
  \[ (0x)Hex-Address:Size(:Type:Signedness) ] (Read / Command)
  - *Hex-Address*: As seen in FSUIPC's Offsets Status Document (first column). A 4-digit Hex-Number. It can be prefixed with 0x and can be written in upper- or lower-case (the PI will only check mark upper-case, but lower-case does work).
  - *Size*: The Size of this Offset in Bytes (same Document, second column). A 1-digit Number.
  - *Type*: Specify if the Offset is Integer \[**i**], Float/Double \[**f**] or String \[**s**]. Defaults to ":i" for Integers if not specified.
  - *Signedness*: Specify if the Offset is Signed \[**s**] or Unsigned \[**u**]. Defaults to ":u" for Unsigned if not specified.<br/><br/>
*Examples*:
  - 2118:8:f for "Turbine Engine 2 corrected N1" (8 byte double/float64)
  - 034E:2 for "COM1 frequency in BCD" (2 byte integer)
  - 3544:4:i:s for "standby alitmeter in feet" (4 byte signed integer)
  - 0x0ec6:2:i for "Pressure QNH"
* **Lvar**
  \[ (L:)Name | (L:)Name((:L):Name)* ] (Read / Command)
  - *Name*: The Lvar's Name with or without the preceding "L:". For Switches you can bind multiple Lvars to it, every Lvar is separated by ":". Multiple Lvars only make sense if they react same for a same value (e.g. Landing Light Switches, all reacting as "on" for "1")
* **Control**
  \[ Control(:Parameter)* ] (Command)
  - The known "FS Controls". First the *Control*-Number and then 0 or more *Parameter* for that Control. (e.g. Landing Light Switches, move them up two times and/or move multiple at one)
* **Macro**
  \[ File\:Macro(:Macro) ] (Command)
  - *File*: The FSUIPC Macro File Name without Extension
  - *Macro*: The Macro's Name within that File. You can specify multiple Macros within one File (e.g. both Packs-Controls on one Button)
* **Script**
  \[ Lua:File ] (Command)
  - *File*: The Filename of a Lua-Script (known to FSUIPC). Without Extension and it has to be preceded with "*Lua:*".<br/>
#### DecodeBCD / Scale / Format
* **DecodeBCD**: If the Value is an BCD, the Plugin can decode it for you! 
* **Scale**: Multiply the Value by that Number to scale it, if it is too big or small. Defaults to 1.<br/>One Example would be "Pressure QNH as millibars" - it is delivered as multiple of 16 (e.g. 1022 = 16352). So we would scale it by "0.0625" (1/16) to have a human-readable Value.
* **Format**: Round the Value and/or add Text to it \[ Digits:Text %s Text ]
  - *Digits*: The Value is rounded to that fixed Number of Digits after the decimal Point (can be zero for an Integer). If not specified, the Value is not rounded at all.
  - *Text*: The Value is embedded at the "*%s*" in the Text you specify here. E.g. to add Units to the Value like "%s kg" or "%s %". Or put something in front of it. Every "%s" will be replaced by the Value.
* **Order**: DecodeBCD -> Scale -> Round -> Format. If the Value is to be matched (~On/Off State e.g.) it is done after Round and before Format.
* **Examples**
  - *1*     One Digit after the Decimal Point, Value will be display as 20.5% for Example.
  - *2:1%s* Two Digits and add an "1" before the Text - useful for the BCD encoded Frequencies!
  - *%s ft* Add "ft" after the Value<br/>
#### Images
All Images are stored in the \Images Subdirectory. You can change and remove the existing ones and you can add your own Images. Newly added Images are automatically listed when you open any of the Actions Property Inspector, you don't have to restart the StreamDeck Software. If you change an existing Image, you have have to switch Profiles or restart the Software - all used (displayed) Images are cached, so all Actions using that Image must disappear before an Image is loaded from Disk.
* **Default Image**: The Image to be shown when the Action is in their normal/working State or P3D is not loaded.
* **Error Image**: The Image to be shown when FSUIPC disconnects or the Value could not be read.
* **Special / Indication Image**: If the Value / Switch has an Special 2nd or 3rd State, you can indicate that by the Image specified. For Example if the Baro is on STD/1013, the PACK is on "Fault", the APU is "Avail", ...<br/>
#### Font Settings
For Actions which show Text, the used Font can be customized.<br/>
The default Behavior is to Inherit the Font from the StreamDeck. Whatever you set there in Font, Size, Style is applied to the Text (all but Alignment and Show/Hide).<br/>
*BUT, there is a caveat in the StreamDeck SDK.* The Font Style (Regular, Bold, Italic) is transmitted as *localized* Text and for now I have only the german strings for that. These strings can be edited in the [Application Settings]. If you share with me what works for your language, I can surely put it in.<br>
If you care at all to inherit the Font: Since the Plugin reads *all* installed Fonts on your System (in Contrast to StreamDeck), you can use nearly any fancy Font you like.
<br/><br/>
### Display Value
<br/><br/>
### Switch / Display Value with Switch
<br/><br/>
### Dynamic Button
<br/><br/>
### COM Radio
<br/><br/>
### Display Gauge
<br/><br/>
### Display Gauge (Dual)
<br/><br/>
## License
Published under [MIT License](https://github.com/Fragtality/PilotsDeck/blob/master/LICENSE).<br/>
Uses "StreamDeckToolkit" from FritzAndFriends, published under [MIT License](https://github.com/FritzAndFriends/StreamDeckToolkit/blob/dev/LICENSE)<br/>
Uses "FSUIPC Client DLL for .NET" from Paul Henty \([License](http://fsuipc.paulhenty.com/index.html#licence))<br/>
Prepar3D is a Trademark or Registered Trademark of Lockheed Martin Corporation.<br/>
StreamDeck is a Trademark or Registered Trademark of Elgato Systems and/or Corsair Gaming, Inc.<br/>
Windows is a Trademark or Registered Trademark of Microsoft Corporation.<br/>
